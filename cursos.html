<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cursos - Área de Administração</title>
    <!-- Estilos globais -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/dashbord.css">
    <!-- Estilo específico da página de cursos -->
    <link rel="stylesheet" href="css/cursos.css">
</head>

<body>
    <!-- Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="meu-logo">
                <a href="index.html" target="_blank">
                    <img src="Icone/Ativo 1 2.png" alt="ANGORGE LDA">
                </a>
            </div>
            <nav class="nav-menu">
                <a href="dashbord.html" class="nav-item"><i class="fas fa-home"></i></a>
                <a href="cursos.html" class="nav-item active"><i class="fas fa-graduation-cap"></i></a>
                <a href="artigo.html" class="nav-item"><i class="fas fa-file-edit"></i></a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-text">

                </div>
                <div class="user-header">
                    <i class="fas fa-bell"></i>
                    <img src="Imagem/medium-shot-man-working-as-real-estate-agent.jpg" alt="Joaquim">
                    <span>Joaquim</span>
                </div>
            </header>

            <!-- Conteúdo Principal -->
            <div class="content-wrapper">
                <div class="content-header">
                    <div>
                        <h2>Cursos</h2>
                        <p>Gerencie todos os cursos disponíveis no site.</p>
                    </div>
                    <a href="novocurso.html" class="btn-add">
                        <i class="fas fa-plus"></i> ADICIONAR
                    </a>
                </div>

                <!-- Tabela de Cursos -->
                <table class="courses-table">
                    <thead>
                        <tr>
                            <th>Nome do Curso</th>
                            <th>Categoria</th>
                            <th>Duração</th>
                            <th>Tipo</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="course-image-placeholder">C</div>
                                Contabilidade Geral e Analítica
                            </td>
                            <td>Contabilidade</td>
                            <td>40 horas</td>
                            <td>Online</td>
                            <td><span class="status-badge status-disponivel">Disponível Agora</span></td>
                            <td>
                                <div class="actions-menu">
                                    <button class="action-btn" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="course-image-placeholder">M</div>
                                Marketing Digital para Iniciantes
                            </td>
                            <td>Marketing</td>
                            <td>30 horas</td>
                            <td>Online</td>
                            <td><span class="status-badge status-em-breve">Em Breve</span></td>
                            <td>
                                <div class="actions-menu">
                                    <button class="action-btn" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="course-image-placeholder">T</div>
                                Introdução ao JavaScript
                            </td>
                            <td>Tecnologia</td>
                            <td>25 horas</td>
                            <td>Online</td>
                            <td><span class="status-badge status-encerrado">Encerrado</span></td>
                            <td>
                                <div class="actions-menu">
                                    <button class="action-btn" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Paginação -->
                <div class="pagination">
                    <button>Anterior</button>
                    <button>01</button>
                    <button>02</button>
                    <button class="active">03</button>
                    <button>04</button>
                    <button>...</button>
                    <button>10</button>
                    <button>Próxima</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Buscar o nome guardado
        const user = localStorage.getItem("user");

        if (user) {
            document.querySelector(".user-header span").textContent = user;
        } else {
            window.location.href = "login.html";
        }

        let paginaAtual = 1;
        const limite = 5; // cursos por página

        // --- Buscar cursos do backend com paginação ---
        async function carregarCursos(page = 1) {
            try {
                const response = await fetch(`http://localhost:5000/api/cursos?page=${page}&limit=${limite}`);
                const data = await response.json();

                const tbody = document.querySelector(".courses-table tbody");
                tbody.innerHTML = ""; // limpa a tabela

                data.cursos.forEach(curso => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>
                        ${curso.imagem
                            ? `<img src="http://localhost:5000${curso.imagem}" class="course-image" alt="${curso.titulo}">`
                            : `<div class="course-image-placeholder">${curso.titulo.charAt(0).toUpperCase()}</div>`}
                        ${curso.titulo}
                    </td>
                    <td>${curso.categoria || "-"}</td>
                    <td>${curso.duracao ? curso.duracao + " horas" : "-"}</td>
                    <td>${curso.tipo || "-"}</td>
                    <td><span class="status-badge ${curso.status === "Disponível Agora" ? "status-disponivel" : (curso.status === "Em Breve" ? "status-em-breve" : "status-encerrado")}">${curso.status || "-"}</span></td>
                    <td>
                        <div class="actions-menu">
                            <button class="action-btn" title="Editar" onclick="editarCurso('${curso._id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" title="Excluir" onclick="excluirCurso('${curso._id}', this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                    tbody.appendChild(row);
                });

                // Atualiza a paginação
                renderizarPaginacao(data.page, data.totalPages);
            } catch (error) {
                console.error("Erro ao carregar cursos:", error);
                alert("❌ Não foi possível carregar os cursos.");
            }
        }

        // --- Renderizar os botões da paginação ---
        function renderizarPaginacao(pagina, totalPaginas) {
            const paginacao = document.querySelector(".pagination");
            paginacao.innerHTML = "";

            // Botão anterior
            if (pagina > 1) {
                const btnAnt = document.createElement("button");
                btnAnt.textContent = "Anterior";
                btnAnt.onclick = () => carregarCursos(pagina - 1);
                paginacao.appendChild(btnAnt);
            }

            // Números das páginas
            for (let i = 1; i <= totalPaginas; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                if (i === pagina) btn.classList.add("active");
                btn.onclick = () => carregarCursos(i);
                paginacao.appendChild(btn);
            }

            // Botão próximo
            if (pagina < totalPaginas) {
                const btnProx = document.createElement("button");
                btnProx.textContent = "Próxima";
                btnProx.onclick = () => carregarCursos(pagina + 1);
                paginacao.appendChild(btnProx);
            }
        }

        // Funções de editar/excluir
        function editarCurso(id) {
            window.location.href = `editarcursos.html?id=${id}`;
        }

        async function excluirCurso(id, btn) {
            if (confirm("Tem certeza que deseja excluir este curso?")) {
                try {
                    const response = await fetch(`http://localhost:5000/api/cursos/${id}`, {
                        method: "DELETE"
                    });
                    const data = await response.json();
                    alert(data.message);
                    btn.closest("tr").remove();
                } catch (error) {
                    console.error("Erro ao excluir:", error);
                    alert("❌ Não foi possível excluir o curso.");
                }
            }
        }
        // Carrega a 1ª página ao abrir
        carregarCursos();

    </script>

</body>

</html>